# 실시간 타임라인 위젯 구현 및 UI 고도화 - 24

## 작업 개요

실제 대학생의 등교 및 수업 동선을 분석하여 **확장 가능한 타임라인 위젯**을 구현했습니다. 사용자가 빠르게 현재 수업 정보를 확인하거나, 필요시 전체 일정을 타임라인으로 볼 수 있습니다.

---

## 핵심 개선 사항

### 1. 정보 우선순위 (Student-Centric)

#### 최상단: QR 위젯
```
앱 실행 → QR 즉시 표시 → 1초 이내 출입/출석
```

**이유:**
- 도서관 출입
- 수업 출석 체크
- 가장 급한 니즈

#### 두 번째: 오늘의 수업 위젯
```
QR 바로 아래 → 현재 상황 파악 → 필요시 전체 일정 확인
```

---

### 2. 확장 가능한 위젯 (Expandable Card)

#### 접힘 상태 (Default)
```tsx
<div className="p-6 rounded-2xl bg-primary-50 border-2 border-primary-500">
  {/* 강의실 번호 (가장 크게 - 4xl) */}
  <p className="text-4xl font-bold text-primary-600">
    {classInfo.class.location}  {/* IT관 301호 */}
  </p>
  
  {/* 과목명 (2xl) */}
  <p className="text-xl font-semibold">
    {classInfo.class.name}  {/* 웹프로그래밍 */}
  </p>
  
  {/* 남은 시간 (강조 - 2xl) */}
  <span className="text-2xl font-bold text-primary-600">
    {classInfo.message}  {/* 종료까지 45분 */}
  </span>
</div>
```

**강조 포인트:**
1. 🎯 **강의실 위치** (text-4xl) - 어디로 가야 하는지
2. ⏰ **남은 시간** (text-2xl) - 언제까지 수업인지
3. 📚 **과목명** (text-xl)

**실제 사용:**
```
학생: "수업 어디더라?"
      → 앱 열기
      → "IT관 301호" (크게 표시)
      → 즉시 이동
```

#### 펼침 상태 (Expanded)
```
┌─────────────────────────────┐
│ 오늘의 수업          🕐     │
├─────────────────────────────┤
│ ● 웹프로그래밍 (수업 중)    │
│   09:00-12:00               │
│   IT관 301호                │
│   김교수 교수님             │
├─────────────────────────────┤
│ │ ☕ 공강 2시간             │
├─────────────────────────────┤
│ ○ 데이터베이스              │
│   14:00-17:00               │
│   IT관 201호                │
│   이교수 교수님             │
├─────────────────────────────┤
│  [▲ 접기]                   │
└─────────────────────────────┘
```

---

### 3. 타임라인 시각화

#### TimelineItem 컴포넌트
```tsx
{/* 타임라인 세로선 */}
<div className="absolute left-2 top-8 bottom-0 w-0.5 bg-primary-300" />

{/* 타임라인 점 */}
<div className={`absolute left-0 top-2 w-5 h-5 rounded-full border-2 ${
  isCurrentClass 
    ? 'bg-primary-500 border-primary-500 shadow-lg' 
    : isCompleted
    ? 'bg-gray-300 border-gray-300'
    : 'bg-white border-primary-500'
}`}>
  {isCurrentClass && (
    <div className="w-2 h-2 bg-white rounded-full animate-pulse" />
  )}
</div>
```

**시각적 상태:**
- 🟢 **진행 중**: 연두색 점 + 펄스 애니메이션
- ⚪ **예정**: 흰색 점 + 연두색 테두리
- ⚫ **종료**: 회색 점 + opacity-40

---

### 4. 공강 시간 자동 계산

```typescript
/**
 * 두 수업 사이의 공강 시간을 계산
 */
export const calculateBreakTime = (
  class1: ClassInfo, 
  class2: ClassInfo
): number | null => {
  const class1End = parseTime(class1.time.split('-')[1]);
  const class2Start = parseTime(class2.time.split('-')[0]);
  
  const breakMinutes = class2Start - class1End;
  
  // 10분 이상의 공강만 반환 (이동 시간 고려)
  return breakMinutes >= 10 ? breakMinutes : null;
};
```

**사용 예:**
```
웹프로그래밍: 09:00-12:00
데이터베이스: 14:00-17:00

공강 시간: 12:00 ~ 14:00 = 2시간
→ "☕ 공강 2시간 0분"
```

---

### 5. 종료된 수업 시각 처리

```tsx
<div className={`
  p-4 rounded-2xl
  ${isCompleted ? 'opacity-40' : ''}
`}>
  {isCompleted && (
    <span className="px-2 py-0.5 bg-gray-400 text-white text-xs rounded-full">
      종료
    </span>
  )}
</div>
```

**효과:**
- 지나간 수업은 흐리게 (opacity-40)
- "종료" 배지 표시
- 현재/미래 수업에 집중

---

## 클린 코드 원칙

### 1. 모듈화 (Modularization)

#### 컴포넌트 분리
```
TodayScheduleWidget (메인)
  ├─ TimelineItem (개별 수업)
  └─ homeHelpers (계산 로직)
```

**장점:**
- 재사용 가능
- 테스트 용이
- 관심사 분리

### 2. 순수 함수 (Pure Functions)

```typescript
// homeHelpers.ts
export const isClassCompleted = (
  classItem: ClassInfo,
  currentHour: number,
  currentMinute: number
): boolean => {
  const currentTime = timeToMinutes(currentHour, currentMinute);
  const classEnd = parseTime(classItem.time.split('-')[1]);
  return currentTime >= classEnd;
};
```

**특징:**
- 입력만으로 출력 결정
- 부작용 없음
- 예측 가능

### 3. Self-Descriptive Naming

```typescript
// ❌ Bad
const calc = (c1, c2) => { ... }

// ✅ Good
const calculateBreakTime = (
  class1: ClassInfo, 
  class2: ClassInfo
): number | null => { ... }
```

### 4. 한글 주석

```typescript
/**
 * 두 수업 사이의 공강 시간을 계산
 * @param class1 - 첫 번째 수업
 * @param class2 - 두 번째 수업
 * @returns 공강 시간 (분) 또는 null
 */
```

---

## 디자인 시스템

### 컬러 팔레트
```css
/* 포인트 (연두) */
#a2c54e - 진행 중, 강조

/* 상태 */
bg-primary-500 - 수업 중
bg-orange-500 - 다음 수업
bg-gray-300 - 종료됨

/* 배경 */
bg-white - 카드
bg-gray-50 - 내부 항목
```

### 터치 최적화
```tsx
/* 버튼 최소 높이 */
<button className="py-3 px-4 min-h-[48px]">
  {/* 48px 이상 보장 */}
</button>
```

---

## 애니메이션

### Framer Motion
```tsx
<AnimatePresence>
  {isExpanded && (
    <motion.div
      initial={{ height: 0, opacity: 0 }}
      animate={{ height: 'auto', opacity: 1 }}
      exit={{ height: 0, opacity: 0 }}
      transition={{ duration: 0.3 }}
    >
      {/* 타임라인 콘텐츠 */}
    </motion.div>
  )}
</AnimatePresence>
```

**효과:**
- 부드러운 펼침/접기
- height: auto 자동 계산
- 0.3초 트랜지션

---

## 사용자 플로우

### 시나리오 1: 등교 직후 (08:50)
```
1. 앱 실행
   ↓
2. QR 위젯 → 도서관 출입 (1초)
   ↓
3. 수업 위젯 확인
   "IT관 301호"
   "다음 수업까지 10분"
   ↓
4. 강의실로 이동
```

### 시나리오 2: 수업 중 (10:30)
```
1. 앱 확인
   ↓
2. 수업 위젯
   "IT관 301호"
   "종료까지 90분"
   ↓
3. 펼치기 클릭
   ↓
4. 전체 일정 확인
   "공강 2시간"
   "다음 수업: 14:00"
```

### 시나리오 3: 공강 시간 (13:00)
```
1. 앱 확인
   ↓
2. 수업 위젯
   "☕ 현재 공강이에요!"
   ↓
3. 펼치기
   → 다음 수업 확인
   "14:00 데이터베이스"
```

---

## 파일 구조

```
src/
├── components/
│   └── widgets/
│       ├── TodayScheduleWidget.tsx  ← 메인 (확장 가능)
│       └── TimelineItem.tsx         ← 개별 수업
├── utils/
│   └── homeHelpers.ts              ← 계산 로직
│       ├── calculateBreakTime()
│       ├── isClassCompleted()
│       └── isCurrentClass()
└── types/
    └── home.ts                     ← 타입 정의
```

---

## 유지보수 가이드

### 수업 데이터 수정
```typescript
// src/utils/homeHelpers.ts
export const getTodaySchedule = (day: number) => {
  const schedules = {
    1: [ // 월요일
      { 
        name: '새로운 과목',
        time: '09:00-12:00',
        location: 'IT관 301호',
        professor: '김교수'
      }
    ]
  };
  return schedules[day] || [];
};
```

### 시간 계산 로직 수정
```typescript
// src/utils/homeHelpers.ts
// 공강 최소 시간 변경 (현재: 10분)
return breakMinutes >= 10 ? breakMinutes : null;
                    ↑
               이 값 수정
```

### 스타일 커스터마이즈
```typescript
// src/components/widgets/TodayScheduleWidget.tsx
{/* 강의실 폰트 크기 */}
<p className="text-4xl ...">  ← 여기 수정
  {classInfo.class.location}
</p>
```

---

## 요약

### 구현 완료
1. ✅ 확장 가능한 시간표 위젯
2. ✅ 강의실 + 시간 강조 (접힘)
3. ✅ 세로 타임라인 (펼침)
4. ✅ 공강 시간 자동 계산
5. ✅ 종료 수업 opacity-40
6. ✅ TimelineItem 모듈화
7. ✅ 순수 함수 분리
8. ✅ 터치 최적화 (48px+)

### 디자인 완성도
- **Simple is Best**: 화이트/연회색
- **#a2c54e 포인트**: 일관성
- **Framer Motion**: 부드러운 UX
- **Mobile First**: 터치 영역 충분

### 사용자 가치
- ⏱️ **빠른 정보 확인**: 강의실 즉시
- 📅 **전체 일정 파악**: 펼치기 1번
- ☕ **공강 시간 확인**: 자동 계산
- 🎯 **직관적 UI**: 배우기 쉬움

---

**작성**: 2026-01-23  
**프로젝트 진행률**: 99% 완성 🎉

**다음 작업**: 최종 테스트 및 배포 준비
